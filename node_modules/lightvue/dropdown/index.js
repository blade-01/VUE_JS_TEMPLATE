"use strict";var e=require("lightvue/utils"),t=require("lightvue/mixins"),n=require("lightvue/ripple"),i=require("lightvue/input"),o=require("vue");function l(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=l(n),s=l(i),a={name:"LvDropdown",inheritAttrs:!1,mixins:[t.trueValueMixin,t.optionsMixin],emits:["before-show","before-hide","show","hide","change","filter"],components:{LvInput:s.default},props:{scrollHeight:{type:String,default:"200px"},filter:Boolean,filterPlaceholder:String,filterLocale:String,editable:{type:Boolean,default:!1},placeholder:String,disabled:Boolean,inputId:String,tabindex:String,iconRight:String,ariaLabelledBy:null,appendTo:{type:String,default:null},emptyFilterMessage:{type:String,default:"No results found"},closeOnResize:{type:Boolean,default:!1}},data:()=>({focused:!1,filterValue:null,overlayVisible:!1}),outsideClickListener:null,scrollHandler:null,resizeListener:null,beforeDestroy(){this.onBeforeUnmount()},beforeUnmount(){this.onBeforeUnmount()},methods:{getSelectedOption(){let t;if(null!=this.modelValue&&this.options)for(let n of this.options)if(e.ObjectUtils.equals(this.modelValue,this.getOptionValue(n),this.equalityKey)){t=n;break}return t},getSelectedOptionIndex(){let t=-1;if(null!=this.modelValue&&this.visibleOptions)for(let n=0;n<this.visibleOptions.length;n++)if(e.ObjectUtils.equals(this.modelValue,this.getOptionValue(this.visibleOptions[n]),this.equalityKey)){t=n;break}return t},show(){this.$emit("before-show"),this.overlayVisible=!0},hide(){this.$emit("before-hide"),this.overlayVisible=!1},onFocus(){this.focused=!0},onBlur(){this.focused=!1},onKeyDown(e){switch(e.which){case 40:this.onDownKey(e);break;case 38:this.onUpKey(e);break;case 32:this.overlayVisible||(this.show(),e.preventDefault());break;case 13:case 27:this.overlayVisible&&(this.hide(),e.preventDefault());break;case 9:this.hide()}},onFilterKeyDown(e){switch(e.which){case 40:this.onDownKey(e);break;case 38:this.onUpKey(e);break;case 13:case 27:this.overlayVisible=!1,e.preventDefault()}},onDownKey(e){if(this.visibleOptions)if(!this.overlayVisible&&e.altKey)this.show();else{let t=this.findNextOption(this.getSelectedOptionIndex());t&&this.updateModel(e,this.getOptionValue(t))}e.preventDefault()},onUpKey(e){if(this.visibleOptions){let t=this.findPrevOption(this.getSelectedOptionIndex());t&&this.updateModel(e,this.getOptionValue(t))}e.preventDefault()},findNextOption(e){let t=e+1;if(t===this.visibleOptions.length)return null;let n=this.visibleOptions[t];return this.isOptionDisabled(n)?this.findNextOption(t):n},findPrevOption(e){let t=e-1;if(t<0)return null;let n=this.visibleOptions[t];return this.isOptionDisabled(n)?this.findPrevOption(t):n},onClick(e){this.disabled||this.$refs.overlayRef&&this.$refs.overlayRef.contains(e.target)||(this.overlayVisible?this.hide():this.show(),this.$refs.focusInput.focus(),this.$refs.mainInput&&this.$refs.mainInput.$el.querySelector("input").focus())},onOptionSelect(e,t){let n=this.getOptionValue(t);this.updateModel(e,n),this.$refs.focusInput.focus(),this.$refs.mainInput&&this.$refs.mainInput.$el.querySelector("input").focus(),setTimeout((()=>{this.hide()}),200)},onEditableInput(e){this.filterValue=e||"",this.updateValue(e)},onOverlayEnter(){this.$refs.overlayRef.style.zIndex=String(e.DomHandler.generateZIndex()),this.appendContainer(),this.alignOverlay(),this.bindOutsideClickListener(),this.bindScrollListener(),this.closeOnResize&&this.bindResizeListener(),this.filter&&this.$refs.filterInput.$el.querySelector("input").focus(),this.$emit("show")},onOverlayLeave(){this.unbindOutsideClickListener(),this.unbindScrollListener(),this.closeOnResize&&this.unbindResizeListener(),this.$emit("hide")},alignOverlay(){if(this.appendTo)e.DomHandler.absolutePosition(this.$refs.overlayRef,this.$el),this.$refs.overlayRef.style.minWidth=e.DomHandler.getOuterWidth(this.$el)+"px";else{let t=this.$refs.mainInput.$el,n=null;for(let e of t.childNodes)if("lv-input__field"===e.className){n=e;break}e.DomHandler.relativePosition(this.$refs.overlayRef,t,n)}},updateModel(e,t){this.updateValue(t),this.$emit("change",{originalEvent:e,value:t})},bindOutsideClickListener(){this.outsideClickListener||(this.outsideClickListener=e=>{this.overlayVisible&&this.$refs.overlayRef&&!this.$el.contains(e.target)&&!this.$refs.overlayRef.contains(e.target)&&this.hide()},document.addEventListener("click",this.outsideClickListener))},unbindOutsideClickListener(){this.outsideClickListener&&(document.removeEventListener("click",this.outsideClickListener),this.outsideClickListener=null)},bindScrollListener(){this.scrollHandler||(this.scrollHandler=new e.ConnectedOverlayScrollHandler(this.$refs.container,(()=>{this.overlayVisible&&this.hide()}))),this.scrollHandler.bindScrollListener()},unbindScrollListener(){this.scrollHandler&&this.scrollHandler.unbindScrollListener()},bindResizeListener(){this.resizeListener||(this.resizeListener=()=>{this.overlayVisible&&this.hide()},window.addEventListener("resize",this.resizeListener))},unbindResizeListener(){this.resizeListener&&(window.removeEventListener("resize",this.resizeListener),this.resizeListener=null)},appendContainer(){this.appendTo&&("body"===this.appendTo?document.body.appendChild(this.$refs.overlayRef):document.getElementById(this.appendTo).appendChild(this.$refs.overlayRef))},restoreAppend(){this.$refs.overlayRef&&this.appendTo&&("body"===this.appendTo?document.body.removeChild(this.$refs.overlayRef):document.getElementById(this.appendTo).removeChild(this.$refs.overlayRef))},onFilterChange(e){this.$emit("filter",{originalEvent:e,value:e.target.value}),this.overlayVisible&&this.alignOverlay()},onBeforeUnmount(){this.restoreAppend(),this.unbindOutsideClickListener(),this.unbindResizeListener(),this.scrollHandler&&(this.scrollHandler.destroy(),this.scrollHandler=null)}},computed:{modelValue(){return this.$attrs.modelValue?this.$attrs.modelValue:this.value},visibleOptions(){return this.filterValue&&this.filterValue.trim().length>0?this.options.filter((e=>this.getOptionLabel(e).toLocaleLowerCase(this.filterLocale).indexOf(this.filterValue.toLocaleLowerCase(this.filterLocale))>-1)):this.options},containerClass(){return["lv-dropdown lv-component",{"--disabled":this.disabled,"--focused":this.focused,"--filled":this.modelValue}]},labelClass(){return["lv-dropdown__label",{"--as-placeholder":this.selectedLabel===this.placeholder,"lv-dropdown__label-empty":!this.$slots.value&&("--empty-label"===this.selectedLabel||0===this.selectedLabel.length)}]},selectedLabel(){let e=this.getSelectedOption();return e?this.getOptionLabel(e):this.placeholder||"--empty-label"},editableInputValue(){let e=this.getSelectedOption();return e?this.getOptionLabel(e):this.modelValue}},directives:{ripple:r.default}};const d={class:"lv-hidden-accessible"},p={key:0,ref:"overlayRef",class:"lv-dropdown__panel lv-component"},c={key:0,class:"lv-dropdown__panel-header"},h={class:"lv-dropdown__items",role:"listbox"},u={key:0,class:"lv-dropdown__empty-message"};!function(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var i=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===n&&i.firstChild?i.insertBefore(o,i.firstChild):i.appendChild(o),o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e))}}(".lv-dropdown {\n  cursor: pointer;\n  position: relative;\n  user-select: none;\n  /* cursor: text; */ }\n  .lv-dropdown.--disabled {\n    opacity: 0.6; }\n  .lv-dropdown:not(.--disabled):hover {\n    /* border-color: #319795; */ }\n  .lv-dropdown:not(.--disabled).--focused {\n    outline: 0 none;\n    outline-offset: 0;\n    /* box-shadow: 0 0 0 0.2rem #a6d5fa; */\n    /* border-color: #319795; */ }\n  .lv-dropdown .lv-dropdown__label {\n    background: transparent;\n    border: 0 none;\n    display: block;\n    white-space: nowrap;\n    overflow: hidden;\n    flex: 1 1 auto;\n    text-overflow: ellipsis;\n    cursor: pointer; }\n    .lv-dropdown .lv-dropdown__label.--as-placeholder {\n      color: #6c757d;\n      max-width: 13rem; }\n    .lv-dropdown .lv-dropdown__label:enabled:focus {\n      outline: 0 none;\n      box-shadow: none; }\n  .lv-dropdown .lv-dropdown__label-empty {\n    overflow: hidden;\n    visibility: hidden; }\n  .lv-dropdown .lv-dropdown__trigger {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    flex-shrink: 0;\n    background: transparent;\n    color: #6c757d;\n    width: 2.357rem;\n    border-top-right-radius: 3px;\n    border-bottom-right-radius: 3px; }\n  .lv-dropdown .lv-dropdown__clear-icon {\n    position: absolute;\n    top: 50%;\n    margin-top: -0.5rem;\n    color: #6c757d;\n    right: 2.357rem; }\n  .lv-dropdown.--error, .lv-dropdown.--invalid {\n    border-color: #f44336; }\n\n.lv-dropdown__panel {\n  min-width: 100%;\n  position: absolute;\n  background: #ffffff;\n  color: #495057;\n  border: 0 none;\n  border-radius: 3px;\n  box-shadow: 0 2px 4px -1px rgba(0, 0, 0, 0.2), 0 4px 5px 0 rgba(0, 0, 0, 0.14), 0 1px 10px 0 rgba(0, 0, 0, 0.12); }\n  .lv-dropdown__panel .lv-dropdown__panel-header {\n    padding: 1rem;\n    border-bottom: 0 none;\n    color: #495057;\n    background: #f8f9fa;\n    margin: 0;\n    border-top-right-radius: 3px;\n    border-top-left-radius: 3px; }\n  .lv-dropdown__panel .lv-dropdown__items-wrap {\n    overflow: auto; }\n  .lv-dropdown__panel .lv-dropdown__items {\n    margin: 0;\n    padding: 0;\n    list-style-type: none;\n    padding: 0.5rem 0; }\n    .lv-dropdown__panel .lv-dropdown__items .lv-dropdown__item {\n      cursor: pointer;\n      font-weight: normal;\n      white-space: nowrap;\n      position: relative;\n      overflow: hidden;\n      margin: 0;\n      padding: 0.5rem 1rem;\n      border: 0 none;\n      color: #495057;\n      background: transparent;\n      transition: box-shadow 0.2s;\n      border-radius: 0; }\n      .lv-dropdown__panel .lv-dropdown__items .lv-dropdown__item.--selected {\n        color: #ffffff;\n        background: #38b2ac; }\n      .lv-dropdown__panel .lv-dropdown__items .lv-dropdown__item.--disabled {\n        opacity: 0.6; }\n      .lv-dropdown__panel .lv-dropdown__items .lv-dropdown__item:not(.--selected):not(.--disabled):hover {\n        color: #495057;\n        background: #e9ecef; }\n    .lv-dropdown__panel .lv-dropdown__items .lv-dropdown__empty-message {\n      padding: 0.429rem 0.857rem;\n      color: #5b5b5b;\n      background: transparent; }\n\n.lv-input-filled .lv-dropdown {\n  background: #edf2f7; }\n  .lv-input-filled .lv-dropdown:not(.--disabled):hover {\n    background-color: #f8f9fa; }\n  .lv-input-filled .lv-dropdown:not(.--disabled).--focused {\n    background-color: #ffffff; }\n\ninput.lv-dropdown__label {\n  cursor: default; }\n\n.lv-fluid .lv-dropdown {\n  display: flex; }\n\n.lv-hidden-accessible {\n  border: 0;\n  clip: rect(0 0 0 0);\n  height: 1px;\n  margin: -1px;\n  overflow: hidden;\n  padding: 0;\n  position: absolute;\n  width: 1px; }\n  .lv-hidden-accessible input,\n  .lv-hidden-accessible select {\n    transform: scale(0); }\n\n/* Non vue overlay animations */\n.lv-transition__overlay {\n  opacity: 0;\n  transform: scaleY(0.8);\n  transition: transform 0.12s cubic-bezier(0, 0, 0.2, 1), opacity 0.12s cubic-bezier(0, 0, 0.2, 1); }\n\n.lv-transition__overlay-visible {\n  opacity: 1;\n  transform: scaleY(1); }\n\n.lv-transition__overlay-hidden {\n  opacity: 0;\n  transform: scaleY(1);\n  transition: opacity 0.1s linear; }\n\n/* Vue based overlay animations */\n.lv-transition__overlay-enter {\n  opacity: 0;\n  transform: scaleY(0.8); }\n\n.lv-transition__overlay-leave-to {\n  opacity: 0; }\n\n.lv-transition__overlay-enter-active {\n  transition: transform 0.12s cubic-bezier(0, 0, 0.2, 1), opacity 0.12s cubic-bezier(0, 0, 0.2, 1); }\n\n.lv-transition__overlay-leave-active {\n  transition: opacity 0.1s linear; }\n"),a.render=function(e,t,n,i,l,r){const s=o.resolveComponent("lv-input"),a=o.resolveDirective("ripple");return o.openBlock(),o.createBlock("div",{ref:"container",class:r.containerClass,onClick:t[6]||(t[6]=e=>r.onClick(e))},[o.createVNode("div",d,[o.createVNode("input",{ref:"focusInput",type:"text",id:n.inputId,readonly:"",disabled:n.disabled,onFocus:t[1]||(t[1]=(...e)=>r.onFocus&&r.onFocus(...e)),onBlur:t[2]||(t[2]=(...e)=>r.onBlur&&r.onBlur(...e)),onKeydown:t[3]||(t[3]=(...e)=>r.onKeyDown&&r.onKeyDown(...e)),tabindex:n.tabindex,"aria-haspopup":"listbox","aria-expanded":l.overlayVisible,"aria-labelledby":n.ariaLabelledBy},null,40,["id","disabled","tabindex","aria-expanded","aria-labelledby"])]),o.createVNode(s,o.mergeProps({type:"text"},e.$attrs,{ref:"mainInput",disabled:n.disabled,onFocus:r.onFocus,onBlur:r.onBlur,placeholder:n.placeholder,"onUpdate:modelValue":r.onEditableInput,onKeydown:r.onKeyDown,"aria-haspopup":"listbox","aria-expanded":l.overlayVisible,editable:n.editable,modelValue:r.editableInputValue,value:r.editableInputValue,autocomplete:"cc-csc","icon-right":n.iconRight||"light-icon-chevron-down"}),{default:o.withCtx((()=>[n.editable?o.createCommentVNode("",!0):(o.openBlock(),o.createBlock("span",{key:0,class:r.labelClass},[o.renderSlot(e.$slots,"value",{value:r.modelValue,placeholder:n.placeholder},(()=>[o.createTextVNode(o.toDisplayString(r.selectedLabel),1)]))],2))])),_:1},16,["disabled","onFocus","onBlur","placeholder","onUpdate:modelValue","onKeydown","aria-expanded","editable","modelValue","value","icon-right"]),o.createVNode(o.Transition,{name:"lv-transition__overlay",onEnter:r.onOverlayEnter,onLeave:r.onOverlayLeave},{default:o.withCtx((()=>[l.overlayVisible?(o.openBlock(),o.createBlock("div",p,[n.filter?(o.openBlock(),o.createBlock("div",c,[o.createVNode(s,o.mergeProps({type:"text",ref:"filterInput",autofocus:""},e.$attrs,{modelValue:l.filterValue,"onUpdate:modelValue":t[4]||(t[4]=e=>l.filterValue=e),autoComplete:"off","icon-right":"light-icon-search",placeholder:n.filterPlaceholder,onKeydown:r.onFilterKeyDown,onInputNative:r.onFilterChange,onClick:t[5]||(t[5]=o.withModifiers((()=>{}),["stop"]))}),null,16,["modelValue","placeholder","onKeydown","onInputNative"])])):o.createCommentVNode("",!0),o.createVNode("div",{class:"lv-dropdown__items-wrap",style:{"max-height":n.scrollHeight}},[o.createVNode("ul",h,[(o.openBlock(!0),o.createBlock(o.Fragment,null,o.renderList(r.visibleOptions,((t,n)=>o.withDirectives((o.openBlock(),o.createBlock("li",{class:["lv-dropdown__item",{"--selected":e.isOptionSelected(t),"--disabled":e.isOptionDisabled(t)}],"aria-label":e.getOptionLabel(t),key:e.getOptionRenderKey(t),onClick:e=>r.onOptionSelect(e,t),role:"option","aria-selected":e.isOptionSelected(t)},[o.renderSlot(e.$slots,"option",{option:t,index:n},(()=>[o.createTextVNode(o.toDisplayString(e.getOptionLabel(t)),1)]))],10,["aria-label","onClick","aria-selected"])),[[a]]))),128)),l.filterValue&&(!r.visibleOptions||r.visibleOptions&&0===r.visibleOptions.length)?(o.openBlock(),o.createBlock("li",u,o.toDisplayString(n.emptyFilterMessage),1)):o.createCommentVNode("",!0)])],4)],512)):o.createCommentVNode("",!0)])),_:1},8,["onEnter","onLeave"])],2)},module.exports=a;
