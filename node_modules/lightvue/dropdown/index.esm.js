import{ObjectUtils as e,DomHandler as n,ConnectedOverlayScrollHandler as i}from"lightvue/utils";import{trueValueMixin as t,optionsMixin as o}from"lightvue/mixins";import l from"lightvue/ripple";import s from"lightvue/input";import{resolveComponent as r,resolveDirective as a,openBlock as d,createBlock as p,createVNode as h,mergeProps as c,withCtx as u,renderSlot as v,createTextVNode as f,toDisplayString as b,createCommentVNode as m,Transition as y,withModifiers as w,Fragment as g,renderList as _,withDirectives as O}from"vue";var x={name:"LvDropdown",inheritAttrs:!1,mixins:[t,o],emits:["before-show","before-hide","show","hide","change","filter"],components:{LvInput:s},props:{scrollHeight:{type:String,default:"200px"},filter:Boolean,filterPlaceholder:String,filterLocale:String,editable:{type:Boolean,default:!1},placeholder:String,disabled:Boolean,inputId:String,tabindex:String,iconRight:String,ariaLabelledBy:null,appendTo:{type:String,default:null},emptyFilterMessage:{type:String,default:"No results found"},closeOnResize:{type:Boolean,default:!1}},data:()=>({focused:!1,filterValue:null,overlayVisible:!1}),outsideClickListener:null,scrollHandler:null,resizeListener:null,beforeDestroy(){this.onBeforeUnmount()},beforeUnmount(){this.onBeforeUnmount()},methods:{getSelectedOption(){let n;if(null!=this.modelValue&&this.options)for(let i of this.options)if(e.equals(this.modelValue,this.getOptionValue(i),this.equalityKey)){n=i;break}return n},getSelectedOptionIndex(){let n=-1;if(null!=this.modelValue&&this.visibleOptions)for(let i=0;i<this.visibleOptions.length;i++)if(e.equals(this.modelValue,this.getOptionValue(this.visibleOptions[i]),this.equalityKey)){n=i;break}return n},show(){this.$emit("before-show"),this.overlayVisible=!0},hide(){this.$emit("before-hide"),this.overlayVisible=!1},onFocus(){this.focused=!0},onBlur(){this.focused=!1},onKeyDown(e){switch(e.which){case 40:this.onDownKey(e);break;case 38:this.onUpKey(e);break;case 32:this.overlayVisible||(this.show(),e.preventDefault());break;case 13:case 27:this.overlayVisible&&(this.hide(),e.preventDefault());break;case 9:this.hide()}},onFilterKeyDown(e){switch(e.which){case 40:this.onDownKey(e);break;case 38:this.onUpKey(e);break;case 13:case 27:this.overlayVisible=!1,e.preventDefault()}},onDownKey(e){if(this.visibleOptions)if(!this.overlayVisible&&e.altKey)this.show();else{let n=this.findNextOption(this.getSelectedOptionIndex());n&&this.updateModel(e,this.getOptionValue(n))}e.preventDefault()},onUpKey(e){if(this.visibleOptions){let n=this.findPrevOption(this.getSelectedOptionIndex());n&&this.updateModel(e,this.getOptionValue(n))}e.preventDefault()},findNextOption(e){let n=e+1;if(n===this.visibleOptions.length)return null;let i=this.visibleOptions[n];return this.isOptionDisabled(i)?this.findNextOption(n):i},findPrevOption(e){let n=e-1;if(n<0)return null;let i=this.visibleOptions[n];return this.isOptionDisabled(i)?this.findPrevOption(n):i},onClick(e){this.disabled||this.$refs.overlayRef&&this.$refs.overlayRef.contains(e.target)||(this.overlayVisible?this.hide():this.show(),this.$refs.focusInput.focus(),this.$refs.mainInput&&this.$refs.mainInput.$el.querySelector("input").focus())},onOptionSelect(e,n){let i=this.getOptionValue(n);this.updateModel(e,i),this.$refs.focusInput.focus(),this.$refs.mainInput&&this.$refs.mainInput.$el.querySelector("input").focus(),setTimeout((()=>{this.hide()}),200)},onEditableInput(e){this.filterValue=e||"",this.updateValue(e)},onOverlayEnter(){this.$refs.overlayRef.style.zIndex=String(n.generateZIndex()),this.appendContainer(),this.alignOverlay(),this.bindOutsideClickListener(),this.bindScrollListener(),this.closeOnResize&&this.bindResizeListener(),this.filter&&this.$refs.filterInput.$el.querySelector("input").focus(),this.$emit("show")},onOverlayLeave(){this.unbindOutsideClickListener(),this.unbindScrollListener(),this.closeOnResize&&this.unbindResizeListener(),this.$emit("hide")},alignOverlay(){if(this.appendTo)n.absolutePosition(this.$refs.overlayRef,this.$el),this.$refs.overlayRef.style.minWidth=n.getOuterWidth(this.$el)+"px";else{let e=this.$refs.mainInput.$el,i=null;for(let n of e.childNodes)if("lv-input__field"===n.className){i=n;break}n.relativePosition(this.$refs.overlayRef,e,i)}},updateModel(e,n){this.updateValue(n),this.$emit("change",{originalEvent:e,value:n})},bindOutsideClickListener(){this.outsideClickListener||(this.outsideClickListener=e=>{this.overlayVisible&&this.$refs.overlayRef&&!this.$el.contains(e.target)&&!this.$refs.overlayRef.contains(e.target)&&this.hide()},document.addEventListener("click",this.outsideClickListener))},unbindOutsideClickListener(){this.outsideClickListener&&(document.removeEventListener("click",this.outsideClickListener),this.outsideClickListener=null)},bindScrollListener(){this.scrollHandler||(this.scrollHandler=new i(this.$refs.container,(()=>{this.overlayVisible&&this.hide()}))),this.scrollHandler.bindScrollListener()},unbindScrollListener(){this.scrollHandler&&this.scrollHandler.unbindScrollListener()},bindResizeListener(){this.resizeListener||(this.resizeListener=()=>{this.overlayVisible&&this.hide()},window.addEventListener("resize",this.resizeListener))},unbindResizeListener(){this.resizeListener&&(window.removeEventListener("resize",this.resizeListener),this.resizeListener=null)},appendContainer(){this.appendTo&&("body"===this.appendTo?document.body.appendChild(this.$refs.overlayRef):document.getElementById(this.appendTo).appendChild(this.$refs.overlayRef))},restoreAppend(){this.$refs.overlayRef&&this.appendTo&&("body"===this.appendTo?document.body.removeChild(this.$refs.overlayRef):document.getElementById(this.appendTo).removeChild(this.$refs.overlayRef))},onFilterChange(e){this.$emit("filter",{originalEvent:e,value:e.target.value}),this.overlayVisible&&this.alignOverlay()},onBeforeUnmount(){this.restoreAppend(),this.unbindOutsideClickListener(),this.unbindResizeListener(),this.scrollHandler&&(this.scrollHandler.destroy(),this.scrollHandler=null)}},computed:{modelValue(){return this.$attrs.modelValue?this.$attrs.modelValue:this.value},visibleOptions(){return this.filterValue&&this.filterValue.trim().length>0?this.options.filter((e=>this.getOptionLabel(e).toLocaleLowerCase(this.filterLocale).indexOf(this.filterValue.toLocaleLowerCase(this.filterLocale))>-1)):this.options},containerClass(){return["lv-dropdown lv-component",{"--disabled":this.disabled,"--focused":this.focused,"--filled":this.modelValue}]},labelClass(){return["lv-dropdown__label",{"--as-placeholder":this.selectedLabel===this.placeholder,"lv-dropdown__label-empty":!this.$slots.value&&("--empty-label"===this.selectedLabel||0===this.selectedLabel.length)}]},selectedLabel(){let e=this.getSelectedOption();return e?this.getOptionLabel(e):this.placeholder||"--empty-label"},editableInputValue(){let e=this.getSelectedOption();return e?this.getOptionLabel(e):this.modelValue}},directives:{ripple:l}};const L={class:"lv-hidden-accessible"},V={key:0,ref:"overlayRef",class:"lv-dropdown__panel lv-component"},k={key:0,class:"lv-dropdown__panel-header"},$={class:"lv-dropdown__items",role:"listbox"},C={key:0,class:"lv-dropdown__empty-message"};!function(e,n){void 0===n&&(n={});var i=n.insertAt;if(e&&"undefined"!=typeof document){var t=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===i&&t.firstChild?t.insertBefore(o,t.firstChild):t.appendChild(o),o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e))}}(".lv-dropdown {\n  cursor: pointer;\n  position: relative;\n  user-select: none;\n  /* cursor: text; */ }\n  .lv-dropdown.--disabled {\n    opacity: 0.6; }\n  .lv-dropdown:not(.--disabled):hover {\n    /* border-color: #319795; */ }\n  .lv-dropdown:not(.--disabled).--focused {\n    outline: 0 none;\n    outline-offset: 0;\n    /* box-shadow: 0 0 0 0.2rem #a6d5fa; */\n    /* border-color: #319795; */ }\n  .lv-dropdown .lv-dropdown__label {\n    background: transparent;\n    border: 0 none;\n    display: block;\n    white-space: nowrap;\n    overflow: hidden;\n    flex: 1 1 auto;\n    text-overflow: ellipsis;\n    cursor: pointer; }\n    .lv-dropdown .lv-dropdown__label.--as-placeholder {\n      color: #6c757d;\n      max-width: 13rem; }\n    .lv-dropdown .lv-dropdown__label:enabled:focus {\n      outline: 0 none;\n      box-shadow: none; }\n  .lv-dropdown .lv-dropdown__label-empty {\n    overflow: hidden;\n    visibility: hidden; }\n  .lv-dropdown .lv-dropdown__trigger {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    flex-shrink: 0;\n    background: transparent;\n    color: #6c757d;\n    width: 2.357rem;\n    border-top-right-radius: 3px;\n    border-bottom-right-radius: 3px; }\n  .lv-dropdown .lv-dropdown__clear-icon {\n    position: absolute;\n    top: 50%;\n    margin-top: -0.5rem;\n    color: #6c757d;\n    right: 2.357rem; }\n  .lv-dropdown.--error, .lv-dropdown.--invalid {\n    border-color: #f44336; }\n\n.lv-dropdown__panel {\n  min-width: 100%;\n  position: absolute;\n  background: #ffffff;\n  color: #495057;\n  border: 0 none;\n  border-radius: 3px;\n  box-shadow: 0 2px 4px -1px rgba(0, 0, 0, 0.2), 0 4px 5px 0 rgba(0, 0, 0, 0.14), 0 1px 10px 0 rgba(0, 0, 0, 0.12); }\n  .lv-dropdown__panel .lv-dropdown__panel-header {\n    padding: 1rem;\n    border-bottom: 0 none;\n    color: #495057;\n    background: #f8f9fa;\n    margin: 0;\n    border-top-right-radius: 3px;\n    border-top-left-radius: 3px; }\n  .lv-dropdown__panel .lv-dropdown__items-wrap {\n    overflow: auto; }\n  .lv-dropdown__panel .lv-dropdown__items {\n    margin: 0;\n    padding: 0;\n    list-style-type: none;\n    padding: 0.5rem 0; }\n    .lv-dropdown__panel .lv-dropdown__items .lv-dropdown__item {\n      cursor: pointer;\n      font-weight: normal;\n      white-space: nowrap;\n      position: relative;\n      overflow: hidden;\n      margin: 0;\n      padding: 0.5rem 1rem;\n      border: 0 none;\n      color: #495057;\n      background: transparent;\n      transition: box-shadow 0.2s;\n      border-radius: 0; }\n      .lv-dropdown__panel .lv-dropdown__items .lv-dropdown__item.--selected {\n        color: #ffffff;\n        background: #38b2ac; }\n      .lv-dropdown__panel .lv-dropdown__items .lv-dropdown__item.--disabled {\n        opacity: 0.6; }\n      .lv-dropdown__panel .lv-dropdown__items .lv-dropdown__item:not(.--selected):not(.--disabled):hover {\n        color: #495057;\n        background: #e9ecef; }\n    .lv-dropdown__panel .lv-dropdown__items .lv-dropdown__empty-message {\n      padding: 0.429rem 0.857rem;\n      color: #5b5b5b;\n      background: transparent; }\n\n.lv-input-filled .lv-dropdown {\n  background: #edf2f7; }\n  .lv-input-filled .lv-dropdown:not(.--disabled):hover {\n    background-color: #f8f9fa; }\n  .lv-input-filled .lv-dropdown:not(.--disabled).--focused {\n    background-color: #ffffff; }\n\ninput.lv-dropdown__label {\n  cursor: default; }\n\n.lv-fluid .lv-dropdown {\n  display: flex; }\n\n.lv-hidden-accessible {\n  border: 0;\n  clip: rect(0 0 0 0);\n  height: 1px;\n  margin: -1px;\n  overflow: hidden;\n  padding: 0;\n  position: absolute;\n  width: 1px; }\n  .lv-hidden-accessible input,\n  .lv-hidden-accessible select {\n    transform: scale(0); }\n\n/* Non vue overlay animations */\n.lv-transition__overlay {\n  opacity: 0;\n  transform: scaleY(0.8);\n  transition: transform 0.12s cubic-bezier(0, 0, 0.2, 1), opacity 0.12s cubic-bezier(0, 0, 0.2, 1); }\n\n.lv-transition__overlay-visible {\n  opacity: 1;\n  transform: scaleY(1); }\n\n.lv-transition__overlay-hidden {\n  opacity: 0;\n  transform: scaleY(1);\n  transition: opacity 0.1s linear; }\n\n/* Vue based overlay animations */\n.lv-transition__overlay-enter {\n  opacity: 0;\n  transform: scaleY(0.8); }\n\n.lv-transition__overlay-leave-to {\n  opacity: 0; }\n\n.lv-transition__overlay-enter-active {\n  transition: transform 0.12s cubic-bezier(0, 0, 0.2, 1), opacity 0.12s cubic-bezier(0, 0, 0.2, 1); }\n\n.lv-transition__overlay-leave-active {\n  transition: opacity 0.1s linear; }\n"),x.render=function(e,n,i,t,o,l){const s=r("lv-input"),x=a("ripple");return d(),p("div",{ref:"container",class:l.containerClass,onClick:n[6]||(n[6]=e=>l.onClick(e))},[h("div",L,[h("input",{ref:"focusInput",type:"text",id:i.inputId,readonly:"",disabled:i.disabled,onFocus:n[1]||(n[1]=(...e)=>l.onFocus&&l.onFocus(...e)),onBlur:n[2]||(n[2]=(...e)=>l.onBlur&&l.onBlur(...e)),onKeydown:n[3]||(n[3]=(...e)=>l.onKeyDown&&l.onKeyDown(...e)),tabindex:i.tabindex,"aria-haspopup":"listbox","aria-expanded":o.overlayVisible,"aria-labelledby":i.ariaLabelledBy},null,40,["id","disabled","tabindex","aria-expanded","aria-labelledby"])]),h(s,c({type:"text"},e.$attrs,{ref:"mainInput",disabled:i.disabled,onFocus:l.onFocus,onBlur:l.onBlur,placeholder:i.placeholder,"onUpdate:modelValue":l.onEditableInput,onKeydown:l.onKeyDown,"aria-haspopup":"listbox","aria-expanded":o.overlayVisible,editable:i.editable,modelValue:l.editableInputValue,value:l.editableInputValue,autocomplete:"cc-csc","icon-right":i.iconRight||"light-icon-chevron-down"}),{default:u((()=>[i.editable?m("",!0):(d(),p("span",{key:0,class:l.labelClass},[v(e.$slots,"value",{value:l.modelValue,placeholder:i.placeholder},(()=>[f(b(l.selectedLabel),1)]))],2))])),_:1},16,["disabled","onFocus","onBlur","placeholder","onUpdate:modelValue","onKeydown","aria-expanded","editable","modelValue","value","icon-right"]),h(y,{name:"lv-transition__overlay",onEnter:l.onOverlayEnter,onLeave:l.onOverlayLeave},{default:u((()=>[o.overlayVisible?(d(),p("div",V,[i.filter?(d(),p("div",k,[h(s,c({type:"text",ref:"filterInput",autofocus:""},e.$attrs,{modelValue:o.filterValue,"onUpdate:modelValue":n[4]||(n[4]=e=>o.filterValue=e),autoComplete:"off","icon-right":"light-icon-search",placeholder:i.filterPlaceholder,onKeydown:l.onFilterKeyDown,onInputNative:l.onFilterChange,onClick:n[5]||(n[5]=w((()=>{}),["stop"]))}),null,16,["modelValue","placeholder","onKeydown","onInputNative"])])):m("",!0),h("div",{class:"lv-dropdown__items-wrap",style:{"max-height":i.scrollHeight}},[h("ul",$,[(d(!0),p(g,null,_(l.visibleOptions,((n,i)=>O((d(),p("li",{class:["lv-dropdown__item",{"--selected":e.isOptionSelected(n),"--disabled":e.isOptionDisabled(n)}],"aria-label":e.getOptionLabel(n),key:e.getOptionRenderKey(n),onClick:e=>l.onOptionSelect(e,n),role:"option","aria-selected":e.isOptionSelected(n)},[v(e.$slots,"option",{option:n,index:i},(()=>[f(b(e.getOptionLabel(n)),1)]))],10,["aria-label","onClick","aria-selected"])),[[x]]))),128)),o.filterValue&&(!l.visibleOptions||l.visibleOptions&&0===l.visibleOptions.length)?(d(),p("li",C,b(i.emptyFilterMessage),1)):m("",!0)])],4)],512)):m("",!0)])),_:1},8,["onEnter","onLeave"])],2)};export default x;
