"use strict";var e=require("lightvue/tooltip"),t=require("lightvue/overlay-panel"),n=require("vue");function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var i=o(e);const l=function(){const e=window&&window.getSelection?window.getSelection():document&&document.getSelection?document.getSelection():document&&document.selection?document.selection.createRange().text:void 0,t=e.anchorNode,n=e.focusNode;return{selection:e,container:t&&(t.nodeType!==Node.TEXT_NODE&&t.nodeType!==Node.COMMENT_NODE?t:t.parentElement),endContainer:n&&(n.nodeType!==Node.TEXT_NODE&&n.nodeType!==Node.COMMENT_NODE?n:n.parentElement)}},r=async function(e,t,n){const o=n.getRangeAt(0),i=o.extractContents(),l=await async function(e,t){const n=document.createElement("span");return n.style[t.style]=a(e,t),n}(e,t);l.appendChild(i),s(t,l),d(t,l),o.insertNode(l),n.selectAllChildren(l)},a=function(e,t){if(!e)return t.value;if(t.initial(e))return"initial";const n=c(e,t.style);return t.initial(n)?"initial":t.value};function c(e,t){if("HTML"===e.nodeName.toUpperCase()||"BODY"===e.nodeName.toUpperCase())return null;if(!e.parentNode)return null;return null!==e.style[t]&&void 0!==e.style[t]&&""!==e.style[t]?e:c(e.parentNode,t)}const s=function(e,t){if(!t.hasChildNodes())return;const n=Array.from(t.children).filter((t=>void 0!==t.style[e.style]&&""!==t.style[e.style]));n&&n.length>0&&n.forEach((t=>{t.style[e.style]="",""!==t.getAttribute("style")&&null!==t.style||t.removeAttribute("style")}));const o=Array.from(t.children).map((t=>s(e,t)));o&&o.length};function d(e,t){if(!t.hasChildNodes())return;const n=Array.from(t.children).filter((e=>{const t=e.getAttribute("style");return!t||""===t}));if(n&&n.length>0)return void n.forEach((e=>{const t=e.querySelectorAll("[style]");if(!t||0===t.length){const t=document.createTextNode(e.textContent);e.parentElement.replaceChild(t,e)}}));const o=Array.from(t.children).map((t=>d(e,t)));o&&o.length}const h=function(e=null){const{selection:t,container:n}=l();if(t.toString()){if(n&&n.innerText===t.toString()&&void 0!==n.style.type)return void function(e,t){e.style[t.style]=a(e,t),s(t,e)}(n,{style:e.property,value:e.value,initial:t=>t&&t.style[e.property]===e.value});r(n,{style:e.property,value:e.value,initial:t=>t&&t.style[e.property]===e.value},t)}else{let o=t.getRangeAt(0);o.deleteContents();let i=document.createElement("span");i.innerHTML="​",i.style[e.property]=n.style[e.property]===e.value?"initial":e.value,o.insertNode(i),o.selectNodeContents(i)}},u=function(e=null){const{selection:t,container:n}=l();let o=t.getRangeAt(0),i=n.closest(".lv-text-editor__content p")||n.closest(".lv-text-editor__content div")||n.closest(".lv-text-editor__content h1")||n.closest(".lv-text-editor__content h2")||n.closest(".lv-text-editor__content li");if(t.toString()){let n=document.createElement(e.tag);if(n.innerHTML=t.toString(),i&&i.innerText==t.toString())return void i.replaceWith(n);i&&i.parentNode.insertBefore(n,i.nextSibling)}else if(n.localName==e.tag){let e=document.createElement("p");e.innerHTML=n.innerHTML,n.replaceWith(e)}else{let t=document.createElement(e.tag);t.innerHTML="​",i&&"p"==i.localName&&"<br>"===i.innerHTML.toString()?i.parentNode.insertBefore(t,i):i.parentNode.insertBefore(t,i.nextSibling),o.selectNodeContents(t)}},p=function(e=null){const{selection:t,container:n}=l(),o=t.getRangeAt(0);let i;n.localName!==e.tag?(i=document.createElement(e.tag),i.innerHTML=t.toString()||"​",o.deleteContents(),o.insertNode(i)):(i=document.createElement("span"),i.innerHTML="​",n.parentNode.insertBefore(i,n.nextSibling)),o.selectNodeContents(i)},g=function(e=null){const{selection:t,container:n,endContainer:o}=l(),i=n.closest(".lv-text-editor__content ul")||n.closest(".lv-text-editor__content ol");if(i)if(e.tag!=i.localName){const t=document.createElement(e.tag);for(let e of i.children){const n=document.createElement(e.localName);n.innerHTML=e.innerHTML,t.appendChild(n)}i.parentNode.insertBefore(t,i),i.parentNode.removeChild(i)}else{const e=document.createElement("div");for(let t of i.children){const n=document.createElement("p");n.innerHTML=t.innerHTML,e.appendChild(n)}i.parentNode.insertBefore(e,i),i.parentNode.removeChild(i)}else if(t.toString()){let t=Array.prototype.indexOf.call(n.parentElement.children,n),i=Array.prototype.indexOf.call(o.parentElement.children,o);i<t&&([t,i]=[i,t]);const l=n.parentElement,r=l.children,a=document.createElement(e.tag);l.insertBefore(a,r[t]);for(let e=i;e>=t;e--){const t=document.createElement("li");t.innerHTML=r[e+1].innerHTML,a.prepend(t),l.removeChild(r[e+1])}}else{let o=t.getRangeAt(0);const i=document.createElement(e.tag),l=document.createElement("li");l.innerHTML="​",i.appendChild(l),"p"==n.localName&&"<br>"===n.innerHTML.toString()?n.parentNode.insertBefore(i,n):n.parentNode.insertBefore(i,n.nextSibling),o.selectNodeContents(i)}},f=function(e){const{container:t,endContainer:n}=l(),o=t.closest(".lv-text-editor li")||t.closest(".lv-text-editor li")||t.closest(".lv-text-editor p")||t.closest(".lv-text-editor h1")||t.closest(".lv-text-editor h2")||t.closest(".lv-text-editor__content div"),i=n.closest(".lv-text-editor li")||n.closest(".lv-text-editor li")||n.closest(".lv-text-editor p")||t.closest(".lv-text-editor h1")||t.closest(".lv-text-editor h2")||n.closest(".lv-text-editor__content div");let r=Array.prototype.indexOf.call(o.parentElement.children,o),a=Array.prototype.indexOf.call(i.parentElement.children,i);a<r&&([r,a]=[a,r]);for(let t=r;t<=a;t++)o.parentElement.children[t].classList.contains(e.value)?o.parentElement.children[t].classList.remove(e.value):(["left","right","center","justify"].forEach((e=>{o.parentElement.children[t].classList.remove(e)})),o.parentElement.children[t].classList.toggle(e.value))};var v={components:{LvOverlayPanel:o(t).default},data:()=>({characterCount:0,content:"<p><br/></p>",imgContainer:null,linkContainer:null,linkText:"",linkURL:"",tools:{format:{bold:{action:h,active:!1,icon:"light-icon-bold",name:"Bold",tag:"b",tooltipText:"Bold (Ctrl + B)",property:"font-weight",value:"bold",code:66},italic:{active:!1,icon:"light-icon-italic",name:"Italic",tag:"i",tooltipText:"Italic (Ctrl + I)",action:h,property:"font-style",value:"italic",code:73},underline:{active:!1,icon:"light-icon-underline",name:"Underline",tag:"u",property:"text-decoration-line",value:"underline",tooltipText:"Underline (Ctrl + U)",action:h,code:85},strikethrough:{active:!1,icon:"light-icon-strikethrough",name:"Strikethrough",tag:"s",tooltipText:"Strikethrough (Ctrl + S)",action:h,property:"text-decoration-line",value:"line-through",code:83}},heading:{"heading 1":{active:!1,icon:"light-icon-heading-1",name:"Heading 1",tag:"h1",tooltipText:"Heading 1",action:u},"heading 2":{active:!1,icon:"light-icon-heading-2",name:"Heading 2",tag:"h2",tooltipText:"Heading 2",action:u}},align:{left:{active:!1,icon:"light-icon-align-left",name:"Left Align",tag:"left",tooltipText:"Left Align (Ctrl + L)",action:f,property:"text-align",value:"left",code:76},center:{active:!1,icon:"light-icon-align-center",name:"Center Align",tag:"center",tooltipText:"Center Align (Ctrl + E)",action:f,property:"text-align",value:"center",code:69},right:{active:!1,icon:"light-icon-align-right",name:"Right Align",tag:"right",tooltipText:"Right Align (Ctrl + R)",action:f,property:"text-align",value:"right",code:82},justify:{active:!1,icon:"light-icon-align-justified",name:"Justify Align",tag:"justify",tooltipText:"Justify Align (Ctrl + J)",action:f,property:"text-align",value:"justify",code:74}},link:{active:!1,icon:"light-icon-link",name:"Link",tag:"a",tooltipText:"Link (Ctrl + K)",code:75},code:{active:!1,icon:"light-icon-code",name:"Code",tag:"code",tooltipText:"Code",action:p},image:{active:!1,icon:"light-icon-photo",name:"Image",tag:"img",tooltipText:"Insert Image",code:80},list:{numbered:{active:!1,icon:"light-icon-list-numbered",name:"Numbered List",tag:"ol",tooltipText:"Numbered List",action:g},bulleted:{active:!1,icon:"light-icon-list",name:"Bulleted List",tag:"ul",tooltipText:"Bulleted List",action:g}}}}),directives:{tooltip:i.default},computed:{editorTools(){return this.menu.map((e=>e.toLowerCase())).filter((e=>e in this.tools||e in this.tools.format||e in this.tools.heading)).map((e=>this.tools.format[e]||this.tools.heading[e]||("align"==e||"list"==e?Object.values(this.tools[e]):this.tools[e]))).flat(1/0)}},methods:{action(e,t=null){if(this.checkFocus(),t&&(e=this.editorTools.find((e=>e.code==t))),e){if("text-align"==e.property&&["center","left","right","justify"].filter((t=>t!==e.value)).forEach((e=>{const t=this.editorTools.find((t=>t.value==e));t&&(t.active=!1)})),e.active=!e.active,"Link"==e.name)return void this.handleLink();if("Image"==e.name)return void this.$refs.imageInput.click();e.action(e,t)}},checkFocus(){const{selection:e,container:t}=l();if(!t||!t.closest(".lv-text-editor__content")){let t=document.createRange();t.selectNodeContents(this.$refs.content.lastElementChild),t.collapse(!1),e.removeAllRanges(),e.addRange(t)}},close(){this.linkContainer&&"a"===this.linkContainer.localName&&!this.linkContainer.hasAttribute("href")&&this.linkContainer.parentNode.removeChild(this.linkContainer),this.editorTools.find((e=>"Link"==e.name)).active=!1,this.$refs.linkOP.hide()},handleInput(){""!=this.$refs.content.innerHTML&&"<div><br/></div>"!=this.$refs.content.innerHTML||(this.$refs.content.innerHTML="<p><br/></p>"),this.updateCharacterCount()},handleKeyControls(e){if(this.toggleButtons(e),e.ctrlKey)switch(e.keyCode){case 66:case 73:case 83:case 85:case 76:case 69:case 74:case 82:case 75:case 80:e.preventDefault(),this.action(null,e.keyCode)}},handleLink(){const{selection:e,container:t}=l(),n=t.closest(".lv-text-editor__content a");if(this.linkURL=this.linkText="",!n){this.linkText=this.linkURL="";let t=e.getRangeAt(0);const n=document.createElement("a");return this.linkContainer=n,this.linkText=e.toString()||"",this.range=t,t.insertNode(n),void this.$refs.linkOP.toggle(null,n)}this.linkContainer=n,this.linkURL=n.href,this.linkText=n.innerText,this.$refs.linkOP.toggle(null,n||t)},onFileChange({target:e}){const t=e&&e.files&&e.files[0];if(t){const e=document.createElement("img");e.src=URL.createObjectURL(t);const{selection:n}=l();let o=n.getRangeAt(0);o.insertNode(e),o.collapse(!1)}},toggleButtons(e){const{container:t}=l();["bold","italic","underline","line-through"].forEach((e=>{const n=this.editorTools.find((t=>t.value==e));if(n){const e=t.closest(`span[style*="${n.property}: ${n.value}"]`),o=t.closest(`span[style*="${n.property}: initial"]`);n.active=!(!e||o&&e.contains(o))}})),["h1","h2","code","ul","ol","a"].forEach((e=>{const n=this.editorTools.find((t=>t.tag==e));n&&(n.active=!!t.closest(`.lv-text-editor__content ${e}`))})),["center","left","right","justify"].forEach((e=>{const n=this.editorTools.find((t=>t.value==e));n&&(n.active=!!t.closest(`.lv-text-editor__content .${e}`))}));const n=t.closest(".lv-text-editor__content a");n&&(this.linkText=n.innerHTML,this.linkContainer=n,this.linkURL=n.href,this.$refs.linkVisitOP.toggle(null,n))},save(){const e="a"===this.linkContainer.localName?this.linkContainer:document.createElement("a");e.innerHTML=this.linkText||this.linkURL,e.href=this.linkURL,this.range&&this.range.deleteContents(),this.range&&this.range.insertNode(this.linkContainer),this.linkContainer=null,this.updateCharacterCount(),this.$refs.linkOP.hide()},updateCharacterCount(){this.characterCount=this.$refs.content.innerText.replaceAll("\n","").length||0}},props:{menu:{type:Array,default:()=>["Bold","Italic","Strikethrough","Heading 1","Heading 2","Align","Link","Code","List"],validator:e=>e.every((e=>"string"==typeof e))},theme:{type:String,default:"#ffffff"},color:{type:String,default:"#333333"}}};const m=n.withScopeId("data-v-b77d6246");n.pushScopeId("data-v-b77d6246");const x={class:"lv-text-editor"},y={class:"lv-text-editor__footer"},C=n.createVNode("br",null,null,-1),T=n.createVNode("br",null,null,-1),k=n.createVNode("i",{class:"light-icon-link"},null,-1);n.popScopeId();const b=m(((e,t,o,i,l,r)=>{const a=n.resolveComponent("LvButton"),c=n.resolveComponent("LvInput"),s=n.resolveComponent("LvOverlayPanel"),d=n.resolveDirective("tooltip");return n.openBlock(),n.createBlock("div",x,[n.createVNode("div",{class:"lv-text-editor__toolbar",style:{backgroundColor:o.theme}},[(n.openBlock(!0),n.createBlock(n.Fragment,null,n.renderList(r.editorTools,((e,t)=>n.withDirectives((n.openBlock(),n.createBlock(a,{key:t,icon:e.icon,style:{backgroundColor:o.theme,color:o.color},size:"xl",class:["lv-text-editor__toolbar__btn",{"lv-text-editor__toolbar__btn--active":e.active}],onMousedown:n.withModifiers((t=>r.action(e)),["prevent","stop"])},null,8,["icon","style","class","onMousedown"])),[[d,`${e.tooltipText}`,void 0,{top:!0}]]))),128))],4),n.createVNode("div",{class:"lv-text-editor__content light-scrollbar",ref:"content",contenteditable:"",onKeydown:t[1]||(t[1]=(...e)=>r.handleKeyControls&&r.handleKeyControls(...e)),innerHTML:l.content,onInput:t[2]||(t[2]=(...e)=>r.handleInput&&r.handleInput(...e)),onClick:t[3]||(t[3]=n.withModifiers(((...e)=>r.toggleButtons&&r.toggleButtons(...e)),["prevent"]))},null,40,["innerHTML"]),n.createVNode("div",y,"Characters: "+n.toDisplayString(l.characterCount),1),n.createVNode(s,{ref:"linkOP",appendTo:"body",style:{"max-width":"300px"},dismissable:!1},{default:m((()=>[n.createVNode(c,{label:"URL",type:"url",modelValue:l.linkURL,"onUpdate:modelValue":t[4]||(t[4]=e=>l.linkURL=e),modelModifiers:{trim:!0}},null,8,["modelValue"]),C,n.createVNode(c,{label:"Link text",type:"text",modelValue:l.linkText,"onUpdate:modelValue":t[5]||(t[5]=e=>l.linkText=e),modelModifiers:{trim:!0}},null,8,["modelValue"]),T,n.createVNode(a,{label:"Set",onClick:n.withModifiers(r.save,["prevent"])},null,8,["onClick"]),n.createVNode(a,{label:"Cancel",onClick:n.withModifiers(r.close,["prevent"])},null,8,["onClick"])])),_:1},512),n.createVNode(s,{ref:"linkVisitOP",appendTo:"body",style:[{"max-width":"500px"},{boxShadow:"1px 1px 2px 2px silver"}]},{default:m((()=>[k,n.createVNode("a",{href:l.linkURL,dismissable:!1,target:"_blank"},n.toDisplayString(l.linkURL),9,["href"])])),_:1},512),n.createVNode("input",{type:"file",ref:"imageInput",hidden:"",accept:"image/*",onChange:t[6]||(t[6]=(...e)=>r.onFileChange&&r.onFileChange(...e))},null,544)])}));function N(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var o=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&o.firstChild?o.insertBefore(i,o.firstChild):o.appendChild(i),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e))}}N(".lv-text-editor {\n  border: 1px solid rgba(75, 75, 75, 0.307);\n  border-radius: 4px;\n  overflow: auto;\n  box-sizing: border-box;\n  width: 100%; }\n  .lv-text-editor__toolbar {\n    display: flex;\n    flex-wrap: wrap;\n    padding: 4px;\n    border-bottom: 1px solid rgba(75, 75, 75, 0.307); }\n    .lv-text-editor__toolbar__btn:hover {\n      filter: brightness(85%); }\n    .lv-text-editor__toolbar__btn--active {\n      font-weight: bolder; }\n  .lv-text-editor__content {\n    padding: 1em;\n    min-height: 120px;\n    background: white;\n    overflow-y: scroll; }\n    .lv-text-editor__content:focus-visible {\n      outline: none; }\n  .lv-text-editor__footer {\n    display: flex;\n    border-top: 1px solid rgba(152, 152, 152, 0.307);\n    justify-content: flex-end;\n    padding: 8px; }\n");N("\n@import './styles/TextContent.css';\n"),v.render=b,v.__scopeId="data-v-b77d6246",module.exports=v;
