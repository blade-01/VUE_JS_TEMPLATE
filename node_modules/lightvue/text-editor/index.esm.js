import e from"lightvue/tooltip";import t from"lightvue/overlay-panel";import{pushScopeId as n,popScopeId as i,resolveComponent as o,resolveDirective as l,openBlock as r,createBlock as a,createVNode as c,Fragment as s,renderList as d,withDirectives as h,withModifiers as u,toDisplayString as p,withScopeId as g}from"vue";const f=function(){const e=window&&window.getSelection?window.getSelection():document&&document.getSelection?document.getSelection():document&&document.selection?document.selection.createRange().text:void 0,t=e.anchorNode,n=e.focusNode;return{selection:e,container:t&&(t.nodeType!==Node.TEXT_NODE&&t.nodeType!==Node.COMMENT_NODE?t:t.parentElement),endContainer:n&&(n.nodeType!==Node.TEXT_NODE&&n.nodeType!==Node.COMMENT_NODE?n:n.parentElement)}},m=async function(e,t,n){const i=n.getRangeAt(0),o=i.extractContents(),l=await async function(e,t){const n=document.createElement("span");return n.style[t.style]=v(e,t),n}(e,t);l.appendChild(o),y(t,l),C(t,l),i.insertNode(l),n.selectAllChildren(l)},v=function(e,t){if(!e)return t.value;if(t.initial(e))return"initial";const n=x(e,t.style);return t.initial(n)?"initial":t.value};function x(e,t){if("HTML"===e.nodeName.toUpperCase()||"BODY"===e.nodeName.toUpperCase())return null;if(!e.parentNode)return null;return null!==e.style[t]&&void 0!==e.style[t]&&""!==e.style[t]?e:x(e.parentNode,t)}const y=function(e,t){if(!t.hasChildNodes())return;const n=Array.from(t.children).filter((t=>void 0!==t.style[e.style]&&""!==t.style[e.style]));n&&n.length>0&&n.forEach((t=>{t.style[e.style]="",""!==t.getAttribute("style")&&null!==t.style||t.removeAttribute("style")}));const i=Array.from(t.children).map((t=>y(e,t)));i&&i.length};function C(e,t){if(!t.hasChildNodes())return;const n=Array.from(t.children).filter((e=>{const t=e.getAttribute("style");return!t||""===t}));if(n&&n.length>0)return void n.forEach((e=>{const t=e.querySelectorAll("[style]");if(!t||0===t.length){const t=document.createTextNode(e.textContent);e.parentElement.replaceChild(t,e)}}));const i=Array.from(t.children).map((t=>C(e,t)));i&&i.length}const T=function(e=null){const{selection:t,container:n}=f();if(t.toString()){if(n&&n.innerText===t.toString()&&void 0!==n.style.type)return void function(e,t){e.style[t.style]=v(e,t),y(t,e)}(n,{style:e.property,value:e.value,initial:t=>t&&t.style[e.property]===e.value});m(n,{style:e.property,value:e.value,initial:t=>t&&t.style[e.property]===e.value},t)}else{let i=t.getRangeAt(0);i.deleteContents();let o=document.createElement("span");o.innerHTML="​",o.style[e.property]=n.style[e.property]===e.value?"initial":e.value,i.insertNode(o),i.selectNodeContents(o)}},k=function(e=null){const{selection:t,container:n}=f();let i=t.getRangeAt(0),o=n.closest(".lv-text-editor__content p")||n.closest(".lv-text-editor__content div")||n.closest(".lv-text-editor__content h1")||n.closest(".lv-text-editor__content h2")||n.closest(".lv-text-editor__content li");if(t.toString()){let n=document.createElement(e.tag);if(n.innerHTML=t.toString(),o&&o.innerText==t.toString())return void o.replaceWith(n);o&&o.parentNode.insertBefore(n,o.nextSibling)}else if(n.localName==e.tag){let e=document.createElement("p");e.innerHTML=n.innerHTML,n.replaceWith(e)}else{let t=document.createElement(e.tag);t.innerHTML="​",o&&"p"==o.localName&&"<br>"===o.innerHTML.toString()?o.parentNode.insertBefore(t,o):o.parentNode.insertBefore(t,o.nextSibling),i.selectNodeContents(t)}},b=function(e=null){const{selection:t,container:n}=f(),i=t.getRangeAt(0);let o;n.localName!==e.tag?(o=document.createElement(e.tag),o.innerHTML=t.toString()||"​",i.deleteContents(),i.insertNode(o)):(o=document.createElement("span"),o.innerHTML="​",n.parentNode.insertBefore(o,n.nextSibling)),i.selectNodeContents(o)},_=function(e=null){const{selection:t,container:n,endContainer:i}=f(),o=n.closest(".lv-text-editor__content ul")||n.closest(".lv-text-editor__content ol");if(o)if(e.tag!=o.localName){const t=document.createElement(e.tag);for(let e of o.children){const n=document.createElement(e.localName);n.innerHTML=e.innerHTML,t.appendChild(n)}o.parentNode.insertBefore(t,o),o.parentNode.removeChild(o)}else{const e=document.createElement("div");for(let t of o.children){const n=document.createElement("p");n.innerHTML=t.innerHTML,e.appendChild(n)}o.parentNode.insertBefore(e,o),o.parentNode.removeChild(o)}else if(t.toString()){let t=Array.prototype.indexOf.call(n.parentElement.children,n),o=Array.prototype.indexOf.call(i.parentElement.children,i);o<t&&([t,o]=[o,t]);const l=n.parentElement,r=l.children,a=document.createElement(e.tag);l.insertBefore(a,r[t]);for(let e=o;e>=t;e--){const t=document.createElement("li");t.innerHTML=r[e+1].innerHTML,a.prepend(t),l.removeChild(r[e+1])}}else{let i=t.getRangeAt(0);const o=document.createElement(e.tag),l=document.createElement("li");l.innerHTML="​",o.appendChild(l),"p"==n.localName&&"<br>"===n.innerHTML.toString()?n.parentNode.insertBefore(o,n):n.parentNode.insertBefore(o,n.nextSibling),i.selectNodeContents(o)}},L=function(e){const{container:t,endContainer:n}=f(),i=t.closest(".lv-text-editor li")||t.closest(".lv-text-editor li")||t.closest(".lv-text-editor p")||t.closest(".lv-text-editor h1")||t.closest(".lv-text-editor h2")||t.closest(".lv-text-editor__content div"),o=n.closest(".lv-text-editor li")||n.closest(".lv-text-editor li")||n.closest(".lv-text-editor p")||t.closest(".lv-text-editor h1")||t.closest(".lv-text-editor h2")||n.closest(".lv-text-editor__content div");let l=Array.prototype.indexOf.call(i.parentElement.children,i),r=Array.prototype.indexOf.call(o.parentElement.children,o);r<l&&([l,r]=[r,l]);for(let t=l;t<=r;t++)i.parentElement.children[t].classList.contains(e.value)?i.parentElement.children[t].classList.remove(e.value):(["left","right","center","justify"].forEach((e=>{i.parentElement.children[t].classList.remove(e)})),i.parentElement.children[t].classList.toggle(e.value))};var N={components:{LvOverlayPanel:t},data:()=>({characterCount:0,content:"<p><br/></p>",imgContainer:null,linkContainer:null,linkText:"",linkURL:"",tools:{format:{bold:{action:T,active:!1,icon:"light-icon-bold",name:"Bold",tag:"b",tooltipText:"Bold (Ctrl + B)",property:"font-weight",value:"bold",code:66},italic:{active:!1,icon:"light-icon-italic",name:"Italic",tag:"i",tooltipText:"Italic (Ctrl + I)",action:T,property:"font-style",value:"italic",code:73},underline:{active:!1,icon:"light-icon-underline",name:"Underline",tag:"u",property:"text-decoration-line",value:"underline",tooltipText:"Underline (Ctrl + U)",action:T,code:85},strikethrough:{active:!1,icon:"light-icon-strikethrough",name:"Strikethrough",tag:"s",tooltipText:"Strikethrough (Ctrl + S)",action:T,property:"text-decoration-line",value:"line-through",code:83}},heading:{"heading 1":{active:!1,icon:"light-icon-heading-1",name:"Heading 1",tag:"h1",tooltipText:"Heading 1",action:k},"heading 2":{active:!1,icon:"light-icon-heading-2",name:"Heading 2",tag:"h2",tooltipText:"Heading 2",action:k}},align:{left:{active:!1,icon:"light-icon-align-left",name:"Left Align",tag:"left",tooltipText:"Left Align (Ctrl + L)",action:L,property:"text-align",value:"left",code:76},center:{active:!1,icon:"light-icon-align-center",name:"Center Align",tag:"center",tooltipText:"Center Align (Ctrl + E)",action:L,property:"text-align",value:"center",code:69},right:{active:!1,icon:"light-icon-align-right",name:"Right Align",tag:"right",tooltipText:"Right Align (Ctrl + R)",action:L,property:"text-align",value:"right",code:82},justify:{active:!1,icon:"light-icon-align-justified",name:"Justify Align",tag:"justify",tooltipText:"Justify Align (Ctrl + J)",action:L,property:"text-align",value:"justify",code:74}},link:{active:!1,icon:"light-icon-link",name:"Link",tag:"a",tooltipText:"Link (Ctrl + K)",code:75},code:{active:!1,icon:"light-icon-code",name:"Code",tag:"code",tooltipText:"Code",action:b},image:{active:!1,icon:"light-icon-photo",name:"Image",tag:"img",tooltipText:"Insert Image",code:80},list:{numbered:{active:!1,icon:"light-icon-list-numbered",name:"Numbered List",tag:"ol",tooltipText:"Numbered List",action:_},bulleted:{active:!1,icon:"light-icon-list",name:"Bulleted List",tag:"ul",tooltipText:"Bulleted List",action:_}}}}),directives:{tooltip:e},computed:{editorTools(){return this.menu.map((e=>e.toLowerCase())).filter((e=>e in this.tools||e in this.tools.format||e in this.tools.heading)).map((e=>this.tools.format[e]||this.tools.heading[e]||("align"==e||"list"==e?Object.values(this.tools[e]):this.tools[e]))).flat(1/0)}},methods:{action(e,t=null){if(this.checkFocus(),t&&(e=this.editorTools.find((e=>e.code==t))),e){if("text-align"==e.property&&["center","left","right","justify"].filter((t=>t!==e.value)).forEach((e=>{const t=this.editorTools.find((t=>t.value==e));t&&(t.active=!1)})),e.active=!e.active,"Link"==e.name)return void this.handleLink();if("Image"==e.name)return void this.$refs.imageInput.click();e.action(e,t)}},checkFocus(){const{selection:e,container:t}=f();if(!t||!t.closest(".lv-text-editor__content")){let t=document.createRange();t.selectNodeContents(this.$refs.content.lastElementChild),t.collapse(!1),e.removeAllRanges(),e.addRange(t)}},close(){this.linkContainer&&"a"===this.linkContainer.localName&&!this.linkContainer.hasAttribute("href")&&this.linkContainer.parentNode.removeChild(this.linkContainer),this.editorTools.find((e=>"Link"==e.name)).active=!1,this.$refs.linkOP.hide()},handleInput(){""!=this.$refs.content.innerHTML&&"<div><br/></div>"!=this.$refs.content.innerHTML||(this.$refs.content.innerHTML="<p><br/></p>"),this.updateCharacterCount()},handleKeyControls(e){if(this.toggleButtons(e),e.ctrlKey)switch(e.keyCode){case 66:case 73:case 83:case 85:case 76:case 69:case 74:case 82:case 75:case 80:e.preventDefault(),this.action(null,e.keyCode)}},handleLink(){const{selection:e,container:t}=f(),n=t.closest(".lv-text-editor__content a");if(this.linkURL=this.linkText="",!n){this.linkText=this.linkURL="";let t=e.getRangeAt(0);const n=document.createElement("a");return this.linkContainer=n,this.linkText=e.toString()||"",this.range=t,t.insertNode(n),void this.$refs.linkOP.toggle(null,n)}this.linkContainer=n,this.linkURL=n.href,this.linkText=n.innerText,this.$refs.linkOP.toggle(null,n||t)},onFileChange({target:e}){const t=e&&e.files&&e.files[0];if(t){const e=document.createElement("img");e.src=URL.createObjectURL(t);const{selection:n}=f();let i=n.getRangeAt(0);i.insertNode(e),i.collapse(!1)}},toggleButtons(e){const{container:t}=f();["bold","italic","underline","line-through"].forEach((e=>{const n=this.editorTools.find((t=>t.value==e));if(n){const e=t.closest(`span[style*="${n.property}: ${n.value}"]`),i=t.closest(`span[style*="${n.property}: initial"]`);n.active=!(!e||i&&e.contains(i))}})),["h1","h2","code","ul","ol","a"].forEach((e=>{const n=this.editorTools.find((t=>t.tag==e));n&&(n.active=!!t.closest(`.lv-text-editor__content ${e}`))})),["center","left","right","justify"].forEach((e=>{const n=this.editorTools.find((t=>t.value==e));n&&(n.active=!!t.closest(`.lv-text-editor__content .${e}`))}));const n=t.closest(".lv-text-editor__content a");n&&(this.linkText=n.innerHTML,this.linkContainer=n,this.linkURL=n.href,this.$refs.linkVisitOP.toggle(null,n))},save(){const e="a"===this.linkContainer.localName?this.linkContainer:document.createElement("a");e.innerHTML=this.linkText||this.linkURL,e.href=this.linkURL,this.range&&this.range.deleteContents(),this.range&&this.range.insertNode(this.linkContainer),this.linkContainer=null,this.updateCharacterCount(),this.$refs.linkOP.hide()},updateCharacterCount(){this.characterCount=this.$refs.content.innerText.replaceAll("\n","").length||0}},props:{menu:{type:Array,default:()=>["Bold","Italic","Strikethrough","Heading 1","Heading 2","Align","Link","Code","List"],validator:e=>e.every((e=>"string"==typeof e))},theme:{type:String,default:"#ffffff"},color:{type:String,default:"#333333"}}};const E=g("data-v-b77d6246");n("data-v-b77d6246");const A={class:"lv-text-editor"},M={class:"lv-text-editor__footer"},H=c("br",null,null,-1),S=c("br",null,null,-1),R=c("i",{class:"light-icon-link"},null,-1);i();const w=E(((e,t,n,i,g,f)=>{const m=o("LvButton"),v=o("LvInput"),x=o("LvOverlayPanel"),y=l("tooltip");return r(),a("div",A,[c("div",{class:"lv-text-editor__toolbar",style:{backgroundColor:n.theme}},[(r(!0),a(s,null,d(f.editorTools,((e,t)=>h((r(),a(m,{key:t,icon:e.icon,style:{backgroundColor:n.theme,color:n.color},size:"xl",class:["lv-text-editor__toolbar__btn",{"lv-text-editor__toolbar__btn--active":e.active}],onMousedown:u((t=>f.action(e)),["prevent","stop"])},null,8,["icon","style","class","onMousedown"])),[[y,`${e.tooltipText}`,void 0,{top:!0}]]))),128))],4),c("div",{class:"lv-text-editor__content light-scrollbar",ref:"content",contenteditable:"",onKeydown:t[1]||(t[1]=(...e)=>f.handleKeyControls&&f.handleKeyControls(...e)),innerHTML:g.content,onInput:t[2]||(t[2]=(...e)=>f.handleInput&&f.handleInput(...e)),onClick:t[3]||(t[3]=u(((...e)=>f.toggleButtons&&f.toggleButtons(...e)),["prevent"]))},null,40,["innerHTML"]),c("div",M,"Characters: "+p(g.characterCount),1),c(x,{ref:"linkOP",appendTo:"body",style:{"max-width":"300px"},dismissable:!1},{default:E((()=>[c(v,{label:"URL",type:"url",modelValue:g.linkURL,"onUpdate:modelValue":t[4]||(t[4]=e=>g.linkURL=e),modelModifiers:{trim:!0}},null,8,["modelValue"]),H,c(v,{label:"Link text",type:"text",modelValue:g.linkText,"onUpdate:modelValue":t[5]||(t[5]=e=>g.linkText=e),modelModifiers:{trim:!0}},null,8,["modelValue"]),S,c(m,{label:"Set",onClick:u(f.save,["prevent"])},null,8,["onClick"]),c(m,{label:"Cancel",onClick:u(f.close,["prevent"])},null,8,["onClick"])])),_:1},512),c(x,{ref:"linkVisitOP",appendTo:"body",style:[{"max-width":"500px"},{boxShadow:"1px 1px 2px 2px silver"}]},{default:E((()=>[R,c("a",{href:g.linkURL,dismissable:!1,target:"_blank"},p(g.linkURL),9,["href"])])),_:1},512),c("input",{type:"file",ref:"imageInput",hidden:"",accept:"image/*",onChange:t[6]||(t[6]=(...e)=>f.onFileChange&&f.onFileChange(...e))},null,544)])}));function B(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var i=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===n&&i.firstChild?i.insertBefore(o,i.firstChild):i.appendChild(o),o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e))}}B(".lv-text-editor {\n  border: 1px solid rgba(75, 75, 75, 0.307);\n  border-radius: 4px;\n  overflow: auto;\n  box-sizing: border-box;\n  width: 100%; }\n  .lv-text-editor__toolbar {\n    display: flex;\n    flex-wrap: wrap;\n    padding: 4px;\n    border-bottom: 1px solid rgba(75, 75, 75, 0.307); }\n    .lv-text-editor__toolbar__btn:hover {\n      filter: brightness(85%); }\n    .lv-text-editor__toolbar__btn--active {\n      font-weight: bolder; }\n  .lv-text-editor__content {\n    padding: 1em;\n    min-height: 120px;\n    background: white;\n    overflow-y: scroll; }\n    .lv-text-editor__content:focus-visible {\n      outline: none; }\n  .lv-text-editor__footer {\n    display: flex;\n    border-top: 1px solid rgba(152, 152, 152, 0.307);\n    justify-content: flex-end;\n    padding: 8px; }\n");B("\n@import './styles/TextContent.css';\n"),N.render=w,N.__scopeId="data-v-b77d6246";export default N;
