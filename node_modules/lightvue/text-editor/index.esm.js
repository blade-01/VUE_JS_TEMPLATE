import e from"lightvue/tooltip";import t from"lightvue/overlay-panel";const n=function(){const e=window&&window.getSelection?window.getSelection():document&&document.getSelection?document.getSelection():document&&document.selection?document.selection.createRange().text:void 0,t=e.anchorNode,n=e.focusNode;return{selection:e,container:t&&(t.nodeType!==Node.TEXT_NODE&&t.nodeType!==Node.COMMENT_NODE?t:t.parentElement),endContainer:n&&(n.nodeType!==Node.TEXT_NODE&&n.nodeType!==Node.COMMENT_NODE?n:n.parentElement)}},i=async function(e,t,n){const i=n.getRangeAt(0),l=i.extractContents(),s=await async function(e,t){const n=document.createElement("span");return n.style[t.style]=o(e,t),n}(e,t);s.appendChild(l),r(t,s),a(t,s),i.insertNode(s),n.selectAllChildren(s)},o=function(e,t){if(!e)return t.value;if(t.initial(e))return"initial";const n=l(e,t.style);return t.initial(n)?"initial":t.value};function l(e,t){if("HTML"===e.nodeName.toUpperCase()||"BODY"===e.nodeName.toUpperCase())return null;if(!e.parentNode)return null;return null!==e.style[t]&&void 0!==e.style[t]&&""!==e.style[t]?e:l(e.parentNode,t)}const r=function(e,t){if(!t.hasChildNodes())return;const n=Array.from(t.children).filter((t=>void 0!==t.style[e.style]&&""!==t.style[e.style]));n&&n.length>0&&n.forEach((t=>{t.style[e.style]="",""!==t.getAttribute("style")&&null!==t.style||t.removeAttribute("style")}));const i=Array.from(t.children).map((t=>r(e,t)));i&&i.length};function a(e,t){if(!t.hasChildNodes())return;const n=Array.from(t.children).filter((e=>{const t=e.getAttribute("style");return!t||""===t}));if(n&&n.length>0)return void n.forEach((e=>{const t=e.querySelectorAll("[style]");if(!t||0===t.length){const t=document.createTextNode(e.textContent);e.parentElement.replaceChild(t,e)}}));const i=Array.from(t.children).map((t=>a(e,t)));i&&i.length}const s=function(e=null){const{selection:t,container:l}=n();if(t.toString()){if(l&&l.innerText===t.toString()&&void 0!==l.style.type)return void function(e,t){e.style[t.style]=o(e,t),r(t,e)}(l,{style:e.property,value:e.value,initial:t=>t&&t.style[e.property]===e.value});i(l,{style:e.property,value:e.value,initial:t=>t&&t.style[e.property]===e.value},t)}else{let n=t.getRangeAt(0);n.deleteContents();let i=document.createElement("span");i.innerHTML="​",i.style[e.property]=l.style[e.property]===e.value?"initial":e.value,n.insertNode(i),n.selectNodeContents(i)}},c=function(e=null){const{selection:t,container:i}=n();let o=t.getRangeAt(0),l=i.closest(".lv-text-editor__content p")||i.closest(".lv-text-editor__content div")||i.closest(".lv-text-editor__content h1")||i.closest(".lv-text-editor__content h2")||i.closest(".lv-text-editor__content li");if(t.toString()){let n=document.createElement(e.tag);if(n.innerHTML=t.toString(),l&&l.innerText==t.toString())return void l.replaceWith(n);l&&l.parentNode.insertBefore(n,l.nextSibling)}else if(i.localName==e.tag){let e=document.createElement("p");e.innerHTML=i.innerHTML,i.replaceWith(e)}else{let t=document.createElement(e.tag);t.innerHTML="​",l&&"p"==l.localName&&"<br>"===l.innerHTML.toString()?l.parentNode.insertBefore(t,l):l.parentNode.insertBefore(t,l.nextSibling),o.selectNodeContents(t)}},d=function(e=null){const{selection:t,container:i}=n(),o=t.getRangeAt(0);let l;i.localName!==e.tag?(l=document.createElement(e.tag),l.innerHTML=t.toString()||"​",o.deleteContents(),o.insertNode(l)):(l=document.createElement("span"),l.innerHTML="​",i.parentNode.insertBefore(l,i.nextSibling)),o.selectNodeContents(l)},u=function(e=null){const{selection:t,container:i,endContainer:o}=n(),l=i.closest(".lv-text-editor__content ul")||i.closest(".lv-text-editor__content ol");if(l)if(e.tag!=l.localName){const t=document.createElement(e.tag);for(let e of l.children){const n=document.createElement(e.localName);n.innerHTML=e.innerHTML,t.appendChild(n)}l.parentNode.insertBefore(t,l),l.parentNode.removeChild(l)}else{const e=document.createElement("div");for(let t of l.children){const n=document.createElement("p");n.innerHTML=t.innerHTML,e.appendChild(n)}l.parentNode.insertBefore(e,l),l.parentNode.removeChild(l)}else if(t.toString()){let t=Array.prototype.indexOf.call(i.parentElement.children,i),n=Array.prototype.indexOf.call(o.parentElement.children,o);n<t&&([t,n]=[n,t]);const l=i.parentElement,r=l.children,a=document.createElement(e.tag);l.insertBefore(a,r[t]);for(let e=n;e>=t;e--){const t=document.createElement("li");t.innerHTML=r[e+1].innerHTML,a.prepend(t),l.removeChild(r[e+1])}}else{let n=t.getRangeAt(0);const o=document.createElement(e.tag),l=document.createElement("li");l.innerHTML="​",o.appendChild(l),"p"==i.localName&&"<br>"===i.innerHTML.toString()?i.parentNode.insertBefore(o,i):i.parentNode.insertBefore(o,i.nextSibling),n.selectNodeContents(o)}},h=function(e){const{container:t,endContainer:i}=n(),o=t.closest(".lv-text-editor li")||t.closest(".lv-text-editor li")||t.closest(".lv-text-editor p")||t.closest(".lv-text-editor h1")||t.closest(".lv-text-editor h2")||t.closest(".lv-text-editor__content div"),l=i.closest(".lv-text-editor li")||i.closest(".lv-text-editor li")||i.closest(".lv-text-editor p")||t.closest(".lv-text-editor h1")||t.closest(".lv-text-editor h2")||i.closest(".lv-text-editor__content div");let r=Array.prototype.indexOf.call(o.parentElement.children,o),a=Array.prototype.indexOf.call(l.parentElement.children,l);a<r&&([r,a]=[a,r]);for(let t=r;t<=a;t++)o.parentElement.children[t].classList.contains(e.value)?o.parentElement.children[t].classList.remove(e.value):(["left","right","center","justify"].forEach((e=>{o.parentElement.children[t].classList.remove(e)})),o.parentElement.children[t].classList.toggle(e.value))};var p={components:{LvOverlayPanel:t},data:()=>({characterCount:0,content:"<p><br/></p>",imgContainer:null,linkContainer:null,linkText:"",linkURL:"",tools:{format:{bold:{action:s,active:!1,icon:"light-icon-bold",name:"Bold",tag:"b",tooltipText:"Bold (Ctrl + B)",property:"font-weight",value:"bold",code:66},italic:{active:!1,icon:"light-icon-italic",name:"Italic",tag:"i",tooltipText:"Italic (Ctrl + I)",action:s,property:"font-style",value:"italic",code:73},underline:{active:!1,icon:"light-icon-underline",name:"Underline",tag:"u",property:"text-decoration-line",value:"underline",tooltipText:"Underline (Ctrl + U)",action:s,code:85},strikethrough:{active:!1,icon:"light-icon-strikethrough",name:"Strikethrough",tag:"s",tooltipText:"Strikethrough (Ctrl + S)",action:s,property:"text-decoration-line",value:"line-through",code:83}},heading:{"heading 1":{active:!1,icon:"light-icon-heading-1",name:"Heading 1",tag:"h1",tooltipText:"Heading 1",action:c},"heading 2":{active:!1,icon:"light-icon-heading-2",name:"Heading 2",tag:"h2",tooltipText:"Heading 2",action:c}},align:{left:{active:!1,icon:"light-icon-align-left",name:"Left Align",tag:"left",tooltipText:"Left Align (Ctrl + L)",action:h,property:"text-align",value:"left",code:76},center:{active:!1,icon:"light-icon-align-center",name:"Center Align",tag:"center",tooltipText:"Center Align (Ctrl + E)",action:h,property:"text-align",value:"center",code:69},right:{active:!1,icon:"light-icon-align-right",name:"Right Align",tag:"right",tooltipText:"Right Align (Ctrl + R)",action:h,property:"text-align",value:"right",code:82},justify:{active:!1,icon:"light-icon-align-justified",name:"Justify Align",tag:"justify",tooltipText:"Justify Align (Ctrl + J)",action:h,property:"text-align",value:"justify",code:74}},link:{active:!1,icon:"light-icon-link",name:"Link",tag:"a",tooltipText:"Link (Ctrl + K)",code:75},code:{active:!1,icon:"light-icon-code",name:"Code",tag:"code",tooltipText:"Code",action:d},image:{active:!1,icon:"light-icon-photo",name:"Image",tag:"img",tooltipText:"Insert Image",code:80},list:{numbered:{active:!1,icon:"light-icon-list-numbered",name:"Numbered List",tag:"ol",tooltipText:"Numbered List",action:u},bulleted:{active:!1,icon:"light-icon-list",name:"Bulleted List",tag:"ul",tooltipText:"Bulleted List",action:u}}}}),directives:{tooltip:e},computed:{editorTools(){return this.menu.map((e=>e.toLowerCase())).filter((e=>e in this.tools||e in this.tools.format||e in this.tools.heading)).map((e=>this.tools.format[e]||this.tools.heading[e]||("align"==e||"list"==e?Object.values(this.tools[e]):this.tools[e]))).flat(1/0)}},methods:{action(e,t=null){if(this.checkFocus(),t&&(e=this.editorTools.find((e=>e.code==t))),e){if("text-align"==e.property&&["center","left","right","justify"].filter((t=>t!==e.value)).forEach((e=>{const t=this.editorTools.find((t=>t.value==e));t&&(t.active=!1)})),e.active=!e.active,"Link"==e.name)return void this.handleLink();if("Image"==e.name)return void this.$refs.imageInput.click();e.action(e,t)}},checkFocus(){const{selection:e,container:t}=n();if(!t||!t.closest(".lv-text-editor__content")){let t=document.createRange();t.selectNodeContents(this.$refs.content.lastElementChild),t.collapse(!1),e.removeAllRanges(),e.addRange(t)}},close(){this.linkContainer&&"a"===this.linkContainer.localName&&!this.linkContainer.hasAttribute("href")&&this.linkContainer.parentNode.removeChild(this.linkContainer),this.editorTools.find((e=>"Link"==e.name)).active=!1,this.$refs.linkOP.hide()},handleInput(){""!=this.$refs.content.innerHTML&&"<div><br/></div>"!=this.$refs.content.innerHTML||(this.$refs.content.innerHTML="<p><br/></p>"),this.updateCharacterCount()},handleKeyControls(e){if(this.toggleButtons(e),e.ctrlKey)switch(e.keyCode){case 66:case 73:case 83:case 85:case 76:case 69:case 74:case 82:case 75:case 80:e.preventDefault(),this.action(null,e.keyCode)}},handleLink(){const{selection:e,container:t}=n(),i=t.closest(".lv-text-editor__content a");if(this.linkURL=this.linkText="",!i){this.linkText=this.linkURL="";let t=e.getRangeAt(0);const n=document.createElement("a");return this.linkContainer=n,this.linkText=e.toString()||"",this.range=t,t.insertNode(n),void this.$refs.linkOP.toggle(null,n)}this.linkContainer=i,this.linkURL=i.href,this.linkText=i.innerText,this.$refs.linkOP.toggle(null,i||t)},onFileChange({target:e}){const t=e&&e.files&&e.files[0];if(t){const e=document.createElement("img");e.src=URL.createObjectURL(t);const{selection:i}=n();let o=i.getRangeAt(0);o.insertNode(e),o.collapse(!1)}},toggleButtons(e){const{container:t}=n();["bold","italic","underline","line-through"].forEach((e=>{const n=this.editorTools.find((t=>t.value==e));if(n){const e=t.closest(`span[style*="${n.property}: ${n.value}"]`),i=t.closest(`span[style*="${n.property}: initial"]`);n.active=!(!e||i&&e.contains(i))}})),["h1","h2","code","ul","ol","a"].forEach((e=>{const n=this.editorTools.find((t=>t.tag==e));n&&(n.active=!!t.closest(`.lv-text-editor__content ${e}`))})),["center","left","right","justify"].forEach((e=>{const n=this.editorTools.find((t=>t.value==e));n&&(n.active=!!t.closest(`.lv-text-editor__content .${e}`))}));const i=t.closest(".lv-text-editor__content a");i&&(this.linkText=i.innerHTML,this.linkContainer=i,this.linkURL=i.href,this.$refs.linkVisitOP.toggle(null,i))},save(){const e="a"===this.linkContainer.localName?this.linkContainer:document.createElement("a");e.innerHTML=this.linkText||this.linkURL,e.href=this.linkURL,this.range&&this.range.deleteContents(),this.range&&this.range.insertNode(this.linkContainer),this.linkContainer=null,this.updateCharacterCount(),this.$refs.linkOP.hide()},updateCharacterCount(){this.characterCount=this.$refs.content.innerText.replaceAll("\n","").length||0}},props:{menu:{type:Array,default:()=>["Bold","Italic","Strikethrough","Heading 1","Heading 2","Align","Link","Code","List"],validator:e=>e.every((e=>"string"==typeof e))},theme:{type:String,default:"#ffffff"},color:{type:String,default:"#333333"}}};function g(e,t,n,i,o,l,r,a,s,c){"boolean"!=typeof r&&(s=a,a=r,r=!1);const d="function"==typeof n?n.options:n;let u;if(e&&e.render&&(d.render=e.render,d.staticRenderFns=e.staticRenderFns,d._compiled=!0,o&&(d.functional=!0)),i&&(d._scopeId=i),l?(u=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),t&&t.call(this,s(e)),e&&e._registeredComponents&&e._registeredComponents.add(l)},d._ssrRegister=u):t&&(u=r?function(e){t.call(this,c(e,this.$root.$options.shadowRoot))}:function(e){t.call(this,a(e))}),u)if(d.functional){const e=d.render;d.render=function(t,n){return u.call(n),e(t,n)}}else{const e=d.beforeCreate;d.beforeCreate=e?[].concat(e,u):[u]}return n}const f="undefined"!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());function v(e){return(e,t)=>function(e,t){const n=f?t.media||"default":e,i=x[n]||(x[n]={ids:new Set,styles:[]});if(!i.ids.has(e)){i.ids.add(e);let n=t.source;if(t.map&&(n+="\n/*# sourceURL="+t.map.sources[0]+" */",n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(t.map))))+" */"),i.element||(i.element=document.createElement("style"),i.element.type="text/css",t.media&&i.element.setAttribute("media",t.media),void 0===m&&(m=document.head||document.getElementsByTagName("head")[0]),m.appendChild(i.element)),"styleSheet"in i.element)i.styles.push(n),i.element.styleSheet.cssText=i.styles.filter(Boolean).join("\n");else{const e=i.ids.size-1,t=document.createTextNode(n),o=i.element.childNodes;o[e]&&i.element.removeChild(o[e]),o.length?i.element.insertBefore(t,o[e]):i.element.appendChild(t)}}}(e,t)}let m;const x={};const y=g({render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"lv-text-editor"},[n("div",{staticClass:"lv-text-editor__toolbar",style:{backgroundColor:e.theme}},e._l(e.editorTools,(function(t,i){return n("LvButton",{directives:[{name:"tooltip",rawName:"v-tooltip.top",value:""+t.tooltipText,expression:"`${tool.tooltipText}`",modifiers:{top:!0}}],key:i,class:["lv-text-editor__toolbar__btn",{"lv-text-editor__toolbar__btn--active":t.active}],style:{backgroundColor:e.theme,color:e.color},attrs:{icon:t.icon,size:"xl"},on:{mousedown:function(n){return n.preventDefault(),n.stopPropagation(),e.action(t)}}})})),1),e._v(" "),n("div",{ref:"content",staticClass:"lv-text-editor__content light-scrollbar",attrs:{contenteditable:""},domProps:{innerHTML:e._s(e.content)},on:{keydown:e.handleKeyControls,input:e.handleInput,click:function(t){return t.preventDefault(),e.toggleButtons(t)}}}),e._v(" "),n("div",{staticClass:"lv-text-editor__footer"},[e._v("Characters: "+e._s(e.characterCount))]),e._v(" "),n("LvOverlayPanel",{ref:"linkOP",staticStyle:{"max-width":"300px"},attrs:{appendTo:"body",dismissable:!1}},[n("LvInput",{attrs:{label:"URL",type:"url"},model:{value:e.linkURL,callback:function(t){e.linkURL="string"==typeof t?t.trim():t},expression:"linkURL"}}),e._v(" "),n("br"),e._v(" "),n("LvInput",{attrs:{label:"Link text",type:"text"},model:{value:e.linkText,callback:function(t){e.linkText="string"==typeof t?t.trim():t},expression:"linkText"}}),e._v(" "),n("br"),e._v(" "),n("LvButton",{attrs:{label:"Set"},on:{click:function(t){return t.preventDefault(),e.save(t)}}}),e._v(" "),n("LvButton",{attrs:{label:"Cancel"},on:{click:function(t){return t.preventDefault(),e.close(t)}}})],1),e._v(" "),n("LvOverlayPanel",{ref:"linkVisitOP",staticStyle:{"max-width":"500px"},style:{boxShadow:"1px 1px 2px 2px silver"},attrs:{appendTo:"body"}},[n("i",{staticClass:"light-icon-link"}),e._v(" "),n("a",{attrs:{href:e.linkURL,dismissable:!1,target:"_blank"}},[e._v("\n      "+e._s(e.linkURL)+"\n    ")])]),e._v(" "),n("input",{ref:"imageInput",attrs:{type:"file",hidden:"",accept:"image/*"},on:{change:e.onFileChange}})],1)},staticRenderFns:[]},(function(e){e&&(e("data-v-513e276c_0",{source:".lv-text-editor{border:1px solid rgba(75,75,75,.307);border-radius:4px;overflow:auto;box-sizing:border-box;width:100%}.lv-text-editor__toolbar{display:flex;flex-wrap:wrap;padding:4px;border-bottom:1px solid rgba(75,75,75,.307)}.lv-text-editor__toolbar__btn:hover{filter:brightness(85%)}.lv-text-editor__toolbar__btn--active{font-weight:bolder}.lv-text-editor__content{padding:1em;min-height:120px;background:#fff;overflow-y:scroll}.lv-text-editor__content:focus-visible{outline:0}.lv-text-editor__footer{display:flex;border-top:1px solid rgba(152,152,152,.307);justify-content:flex-end;padding:8px}",map:void 0,media:void 0}),e("data-v-513e276c_1",{source:"",map:void 0,media:void 0}))}),p,"data-v-513e276c",false,undefined,!1,v,void 0,void 0);export default y;
